---
title: 'Analyzing Nested Data: Comparing Multiple Approaches'
author: bgong
date: '2020-12-10'
slug: analyzing-nested-data-comparing-multiple-approaches
categories:
  - Hierchical linear model (HLM)
  - Multilevel analysis
  - R
tags:
  - lme4
  - R
subtitle: ''
summary: ''
authors: []
lastmod: '2020-12-10T15:31:33-07:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<div id="what-is-nested-data" class="section level2">
<h2><strong>1. What is Nested Data</strong></h2>
<p>Not all data was created to be independent. We often find that the real world data does not meet the strict statistical pressumption that each observation should be independent and identically distributed, so called iid. In many cases, the observations sampled from a population tend to correlate each other because they belong to the same group, region, and culture. Sample data having such common and correlative trait is called nested data.</p>
<p>For instance, students in the same school share a number of trait derived from the school and district features. Students in the same school or district tend to have similar socio-economic status (SES) because students are assigned to the schools based on their residential location. Also, students in the same school tend to share same teachers, school leadership, and school resource. In this account, student samples in the same schools may violate iid principle correlating with each other.</p>
<p> </p>
</div>
<div id="example-data-analysis" class="section level2">
<h2><strong>2. Example Data Analysis</strong></h2>
<p>It can be costly to ignore the nested data structure. In this post, I will show you a difference between the models considering and not considering the nested data structure.</p>
<p>I used international students’ data file for this analysis. The students studied in foreign country through one-year study abroad program to raise intercultural understanding. I analyzed to what extent the self-efficacy level predicts or explains the level of students intercultural understanding.</p>
<div id="explorative-data-analysis" class="section level3">
<h3><strong>2.1. Explorative Data Analysis</strong></h3>
<p>This is the summary of the data set. It tells us there are four variables. Intercultural_Understanding and Self-Efficacy are the continuous variables while rest of Major and Year are categorical variables.</p>
<pre class="r"><code># Use the following packages for the analysis
library(tidyr)
library(dplyr)
library(ggplot2)
library(ggpubr)
# This is just file path in my personal computer so you need to set
# your own directory to retrieve data for the analysis
load(&quot;/Users/bgong/Documents/Career management/Job/CV development/R portfolio/Gong.web/content/post/Nested-data/Nested-data_files/Nested.RData&quot;)

# Summary of the data
summary(Studyabroad)</code></pre>
<pre><code>##  Intercultural_Understanding Self_Efficacy      Major       Year   
##  Min.   :1.000               Min.   :3.000   Eng   :20   18-19:31  
##  1st Qu.:3.250               1st Qu.:4.208   Noneng:52   19-20:41  
##  Median :4.333               Median :5.190                         
##  Mean   :4.089               Mean   :4.980                         
##  3rd Qu.:5.000               3rd Qu.:5.762                         
##  Max.   :6.000               Max.   :6.000                         
##  NA&#39;s   :2                   NA&#39;s   :1</code></pre>
<p>To get a more detailed sense of the data, let’s check the distribution of the data with data visualization.</p>
<pre class="r"><code># Scatter plot
SA &lt;- ggscatter(Studyabroad, x = &quot;Self_Efficacy&quot;, y = &quot;Intercultural_Understanding&quot;,color = &quot;#00AFBB&quot;, size = 1, alpha = 0.6, add = &quot;reg.line&quot;, add.params = list(color = &quot;blue&quot;, fill = &quot;lightgray&quot;),
   conf.int = TRUE, 
   cor.coef = TRUE ,rug = TRUE)+
border()                                         
# Marginal density plot of x (top panel) and y (right panel)
xplot &lt;- ggdensity(Studyabroad, &quot;Self_Efficacy&quot;, fill = &quot;lightgray&quot;)
yplot &lt;- ggdensity(Studyabroad, &quot;Intercultural_Understanding&quot;, fill = &quot;lightgray&quot;)+
rotate()
# Cleaning the plots
SA &lt;- SA + rremove(&quot;legend&quot;)
yplot &lt;- yplot + clean_theme() + rremove(&quot;legend&quot;) 
xplot &lt;- xplot + clean_theme() + rremove(&quot;legend&quot;)
# Arranging the plot using cowplot
library(cowplot)
plot_grid(xplot, NULL, SA, yplot, ncol = 2, align = &quot;hv&quot;, 
      rel_widths = c(2, 1), rel_heights = c(1, 2))</code></pre>
<p><img src="/post/Nested-data/2020-12-10-analyzing-nested-data-comparing-multiple-approaches.en_files/figure-html/unnamed-chunk-2-1.png" width="672" />
### <strong>2.2. Simple Linear Regression</strong></p>
<p>The easiest way to analyze this data is simple linear regression. The analysis summary indicates that the self-efficacy of the students is positively associated with the level of intercultural understanding. The coefficient estimate is 0.3914 and the p-value is significant at 0.05 level.</p>
<pre class="r"><code>summary(lm(Intercultural_Understanding ~ Self_Efficacy , data =  Studyabroad))</code></pre>
<pre><code>## 
## Call:
## lm(formula = Intercultural_Understanding ~ Self_Efficacy, data = Studyabroad)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.9404 -0.9175  0.2527  0.9850  1.8409 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)     2.1298     0.9314   2.287   0.0254 *
## Self_Efficacy   0.3914     0.1841   2.126   0.0372 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.253 on 67 degrees of freedom
##   (3 observations deleted due to missingness)
## Multiple R-squared:  0.06319,    Adjusted R-squared:  0.04921 
## F-statistic:  4.52 on 1 and 67 DF,  p-value: 0.0372</code></pre>
</div>
<div id="hierarchical-linear-modeling-hlm-of-the-regression" class="section level3">
<h3><strong>2.3. Hierarchical Linear Modeling (HLM) of the Regression</strong></h3>
<p>However, the data is stratified with other grouping variables. The data ‘Studyabroad’ has ‘Major’ variable, indicating each students belong to a certain major program. The students’ intercultural understanding explained by self-efficacy may be influenced by their majors.</p>
<p>As the bellow plot indicates, the students in English major and non-English major have different level of intercultural understanding. The red dot in the plot is mean for each group.</p>
<pre class="r"><code>SAplot &lt;- 
    ggplot(Studyabroad, aes(x = Major, y =Intercultural_Understanding)) +
    geom_point() +
    theme_minimal() + stat_summary(fun = &quot;mean&quot;, color = &quot;red&quot;,
                                   size = 3, geom = &quot;point&quot;) +
    xlab(&quot;Intercept groups&quot;)
print(SAplot)</code></pre>
<p><img src="/post/Nested-data/2020-12-10-analyzing-nested-data-comparing-multiple-approaches.en_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
</div>
